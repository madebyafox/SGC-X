---
title: 'SGC_3A: The Insight Hypothesis'
subtitle: 'Primary Analysis for SGC3A'
author: 'Amy Rae Fox'
always_allow_html: true  
output:
  html_document:
    theme: yeti
    code_folding: hide
    fig_caption: yes
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document: 
    toc: true
    toc_depth: 3
    latex_engine: xelatex
font-family: "DejaVu Sans"
mainfont: "DejaVu Sans"
---

\newpage  

```{r SETUP, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE) 

#IMPORT LIBRARIES
library(tidyverse) #ALL THE THINGS

```

*The purpose of this notebook is to harmonize data files for study SGC_3A.*

# INTRODUCTION 
Data for study SGC_3A were collected across four time periods, interrupted by the Covid-19 pandemic. 
Fall 2017: in person, SONA groups in computer lab
Spring 2018: in person, SONA groups in computer lab
Fall 2021: asynchronous, online, SONA
Winter 2022: asynchronous, online, SONA

Data collected in Fall 2017, Spring 2018 constitute the original SGC_3A study, conducted in person. Data collected in Fall 2021, Winter 2022 constitute the web-based replication, conducated online (asynchronously). 


```{r IMPORT-SUBJECTS}
#IMPORT PARTICIPANT DATA

#set datafiles
fall17 <- "data/fall17_sgc3a_participants.csv"
spring18 <- "data/spring18_sgc3a_participants.csv"
fall21 <- "data/fall21_sgc3a_participants.csv"
winter22 <- "data/winter22_sgc3a_participants.csv"

#read datafiles, set mode and term
df_subjects_fall17 <- read.csv(fall17) %>% mutate(mode = "lab-synch", term = "fall17")
df_subjects_spring18 <- read.csv(spring18) %>% mutate(mode = "lab-synch", term = "spring18")
df_subjects_fall21 <- read.csv(fall21) %>% mutate(mode = "online-asynch", term = "fall21")
df_subjects_winter22 <- read.csv(winter22) %>% mutate(mode = "online-asynch", term = "winter22")

#reduce data collected using old webapp
df_subjects <- rbind(df_subjects_fall17, df_subjects_spring18, df_subjects_fall21) %>% 
  mutate(
    totaltime_m = totalTime / 1000 / 60,  
    absolute_score = triangular_score) %>% 
  dplyr::select(subject, condition, session, term, mode, sex, age, totaltime_m, absolute_score)

#reduce data collected using new webapp
df_subjects_winter22 <- df_subjects_winter22 %>% 
  mutate(score = absolute_score, sex = gender) %>% 
  dplyr::select( subject, condition, session, term, mode, sex, age, totaltime_m, absolute_score)

#combine dataframes from old and new webapps
df_subjects <- rbind(df_subjects, df_subjects_winter22) %>% 
  mutate(
    subject = as.factor(subject),
    condition = as.factor(condition),
    session = as.factor(session),
    term = as.factor(term),
    mode = as.factor(mode),
  )

```


```{r IMPORT-ITEMS}

#set datafiles
fall17 <- "data/fall17_sgc3a_blocks.csv"
spring18 <- "data/spring18_sgc3a_blocks.csv"
fall21 <- "data/fall21_sgc3a_blocks.csv"
winter22 <- "data/winter22_sgc3a_items.csv"

#read datafiles, set mode and term
df_items_fall17 <- read.csv(fall17) %>% mutate(mode = "lab-synch", term = "fall17")
df_items_spring18 <- read.csv(spring18) %>% mutate(mode = "lab-synch", term = "spring18")
df_items_fall21 <- read.csv(fall21) %>% mutate(mode = "online-asynch", term = "fall21")
df_items_winter22 <- read.csv(winter22) %>% mutate(mode = "online-asynch", term = "winter22")

#get relations mapping encoded in winter22 data files
map_relations <- df_items_winter22 %>% group_by(q) %>% select(q,relation) %>% unique()
  
#reduce data collected using old webapp
df_items <- rbind(df_items_fall17, df_items_spring18, df_items_fall21) %>% 
  mutate(rt_s = rt / 1000) %>% 
  select(subject, condition, term, mode, question, q, answer, correct, rt_s)
  
#reduce data collected using new webapp
df_items_winter22 <- df_items_winter22 %>% 
  select(subject, condition, term, mode, question, q, answer, correct, rt_s)

#combine dataframes from old and new webapps
df_items <- rbind(df_items, df_items_winter22) %>% 
  mutate(
    subject = as.factor(subject),
    condition = as.factor(condition),
    term = as.factor(term),
    mode = as.factor(mode),
    question = as.factor(question),
    q = as.factor(q),
    answer = as.factor(answer)
  )

```

```{r RECONCILE}

nrow(df_items_winter22) == 15* nrow(df_subjects_winter22) #TRUE #winter has 15 questions
nrow(df_items_fall21) == 16* nrow(df_subjects_fall21) #FALSE #fall had 15 questions + free response
nrow(df_items_spring18) == 16* nrow(df_subjects_spring18) #FALSE
nrow(df_items_fall17) == 15* nrow(df_subjects_fall17) #TRUE #fall had 15 questions

```

Some subjects from Spring 2018 have 15 records, and others have 16. This reflects the addition of the free-response (q #16) near the start of the quarter. 