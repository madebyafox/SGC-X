<!DOCTYPE html>
<meta charset="utf-8">
<head>
 </head>

<body>
  <div class = "container">
    
    <div class = "left">
      
      <!-- hidden response element -->
      <div id="answer" style="display:none"></div> 
      
      <!-- question -->
      <p class="question" id="question"></p>
  
      <!-- scaffolding/hints -->
      <div class = "legend"   >
         <p id="hint-interactive" style="display:none" >Hint: Hover your mouse over the data points in the graph</p>
         <p id="hint-graph-click" style="display:none" >Hint: Click on the data points to answer.</p>
      </div> <!-- end legend -->
  
      <!-- response indicators -->
      <p class = "response" id="graph-response" style="display:none">Your answer : </p>
      <ul class="checkbox-grid" id="answer-grid"></ul>
       
      <!-- submit buttons -->
  
      <div class="fixbottom">  
        <button type="button" id="testingButton" class='btn' onclick=recordAnswer()/*checkTriangularAnswer()*/ >SUBMIT</button>  
      </div>
      
    </div> <!--END LEFT-->

    <div class = "right">
      <div class = "stimulus"></div>
    </div> <!--END RIGHT-->
  
    <p class = "userid" id="userid"></p>
  </div> <!--END container-->

  

</body>
<script>


  //DECLARE VARIABLES ——————————————————————————
  var selectColor = "#3ea5ed";
  // var clicked = ["answer","clicked"]; //populate first row of clicked array with headers
  var hovered = ""; //string for sequence of data points that have been hovered over
  var graphClicked = []
  var clicks = 0; //number of clicks on the page
  var mousesvg = []; //hold mouse movement in svg coord
  var svg, graph, explicit, grid, datafile, colorClick;

  //---------SET PROPERTIES OF THE GRAPH -------------//
  // set the dimensions and margins of the graph
  var margin = {top: 25, right: 30, bottom: 90, left: 100};
  var width, height; 
  var intersects = false; //default value for intersects scaffold
  var xAxisTitle, yAxisTitle;

  // SETUP PAGES 
  $(document).ready(function() {
   
    //count clicks 
    $(".control").click(function(e) {
      e.stopImmediatePropagation();
      clicks = clicks + 1;
      // console.log("clicks: "+clicks);
    });

    //GET STIM PARAMETERS FROM HTML ELEMENT DATA
    data =JSON.parse(document.getElementById("jspsych-data").getAttribute("data"));
    console.log(data); 

    //UPDATE DISPLAY BASED ON DATA 
    $('.userid').html(data.sid); //print subject ID
    $('#question').html(data.question); //display question
    
    //SET ANSWER MODE
    console.log("colorClick: "+data.colorClick);
    if (data.colorClick == true) {// remove checkboxes
      $('#answer-grid').attr("style","display:none");
      $('#hint-graph-click').attr("style","display:block");
      $('#graph-response').attr("style","display:block");
    }
    // //SET HINTS
    if (data.explicit == 2) { //static scaffold
      $(".static-scaffold").css("display","block");
    }
    else if (data.explicit == 3) { //ixn scaffold
      $("#hint-interactive").css("display","block");
      $(".leaders").css("display","block");
    }
    

    //SET STIM PARAMETERS FROM HTML ELEMENT DATA
    graph = data.graph; 
    explicit = data.explicit; 
    grid = data.grid; 
    datafile = "src/data/"+data.datafile;
    colorClick = data.colorClick; 
    width = data.gwidth,
    height = data.gheight;

    //ATTACH SUBMIT BEHAVIOR 
    // $('#submit').on("hover", function(){
    // data.answer=($('textarea').val());
    // });

      //set correct answers for each question
  var triangular_answers = {
    "acme.starttime.1" : ["F"],
    "acme.starts.1" : ["K"],
    "acme.meets.1" : ["F"],
    "acme.endtime.1" : ["H"],
    "acme.midpoint.1" : ["O"],

    "acme.starttime.2" : ["F"],
    "acme.starts.2" : ["K"],
    "acme.meets.2" : ["F"],
    "acme.endtime.2" : ["H"],
    "acme.midpoint.2" : ["A"],

    "bigset.duration.1" : ["E","G"],
    "bigset.duration+starts.1" : ["X","O"],
    "bigset.duration+contained.1" : ["G"],
    "bigset.starttime+before+endtime+during.1": ["I"],
    "bigset.ends.1" : ["E"],

    "bigset.duration.2" : ["E","G"],
    "bigset.duration+starts.2" : ["X","O"],
    "bigset.duration+contained.2" : ["G"],
    "bigset.starttime+before+endtime+during.2":["I"],
    "bigset.ends.2" : ["E"],

    "bigset.starttime.1" : ["M","L"],
    "bigset.starts.1" : ["G"],
    "bigset.meets.1" : ["E","F"],
    "bigset.endtime.1" : ["X"],
    "bigset.midpoint.1" : ["K","X"],

    "bigset.starttime.2" : ["M","L"],
    "bigset.starts.2" : ["G"],
    "bigset.meets.2" : ["E","F"],
    "bigset.endtime.2" : ["X"],
    "bigset.midpoint.2" : ["K","X"]
  }
  var orthogonal_answers = {
    "acme.starttime.1" : ["A"],
    "acme.starts.1" : ["E"],
    "acme.meets.1" : ["Z"],
    "acme.endtime.1" : ["U"],
    "acme.midpoint.1" : ["U"],

    "acme.starttime.2" : ["0"],
    "acme.starts.2" : ["0"],
    "acme.meets.2" : ["0"],
    "acme.endtime.2" : ["0"],
    "acme.midpoint.2" : ["0"],

    "bigset.duration.1" : ["E","G"],
    "bigset.duration+starts.1" : ["F","B"],
    "bigset.duration+contained.1" : ["E"],
    "bigset.starttime+before+endtime+during.1": ["I"],
    "bigset.ends.1" : ["X"],

    "bigset.duration.2" : ["E","G"],
    "bigset.duration+starts.2" : ["F","B"],
    "bigset.duration+contained.2" : ["E"],
    "bigset.starttime+before+endtime+during.2":["I"],
    "bigset.ends.2" : ["X"],

    "bigset.starttime.1" : ["F","B"],
    "bigset.starts.1" : ["B"],
    "bigset.meets.1" : ["F","X"],
    "bigset.endtime.1" : ["B"],
    "bigset.midpoint.1" : ["E","F"],

    "bigset.starttime.2" : ["F","B"],
    "bigset.starts.2" : ["B"],
    "bigset.meets.2" : ["F","X"],
    "bigset.endtime.2" : ["B"],
    "bigset.midpoint.2" : ["E","F"]
  }

  
  //---------CREATE THE SVG  ------------------------//
  svg = d3.select(".stimulus").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform",  "translate(" + margin.left + "," + margin.top + ")")
    .on('mousemove', function() {
        // console.log( d3.mouse(this));
        mousesvg.push(d3.mouse(this));
    }); // log the mouse x,y position in svg coords
  
  //---------DRAW THE GRAPH  ------------------------//
  switch(graph){
    case "triangular":
      xAxisTitle = "START & END TIME (time of day)";
      yAxisTitle = "DURATION (in hours)";
      // console.log("passing scaffold: "+explicit);
      drawTriangleModel(datafile,grid,explicit);
    break;
    
    case "linear":
      xAxisTitle = "START & END TIME (time of day)";
      if (scenario =="longmire"){yAxisTitle = "CONFERENCE ROOM";}
      if (scenario =="axis"){yAxisTitle = "TASK"}
      drawLinearModel(datafile,grid,explicit);
    break;
    
    default:
    $(".stimulus").remove();
    break;
  }

 

});//END document ready

  
</script>

<script>

//MOUSE LOGGING SCRIPT
var mouseLog = []
var xwidth = $(document).width();
var xheight = $(document).width();
mouseLog.push("{x:"+xwidth+",y:"+xheight+",t:"+"0};")

document.onmousemove = function(e){
  var pageCoords = "{x:" + e.pageX + ",y:"+ e.pageY +",t:"+ Date.now()+ "};" ;
  mouseLog.push(pageCoords);
  // console.log(pageCoords);
};

</script>
